---
title: Развертывание приложения в службу приложений — DevOps с ASP.NET Core и Azure
author: CamSoper
description: Развертывание приложения ASP.NET Core в службу приложений Azure является первым шагов в использовании DevOps с ASP.NET Core и Azure.
ms.author: casoper
ms.custom: devx-track-csharp, mvc, seodec18, devx-track-azurecli
ms.date: 10/24/2018
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: azure/devops/deploy-to-app-service
ms.openlocfilehash: f1c7acba0b7fb7dc07da576b188e580328ff4b89
ms.sourcegitcommit: 3593c4efa707edeaaceffbfa544f99f41fc62535
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2021
ms.locfileid: "96901162"
---
# <a name="deploy-an-app-to-app-service"></a>Развертывание приложения в службу приложений

[Служба приложений Azure](/azure/app-service/) — это платформа Azure для размещения веб-сайтов. Развертывание веб-приложения в службу приложений Azure можно выполнять вручную или автоматически. В этом разделе руководства обсуждаются методы развертывания, которые могут запускаться вручную или с помощью сценария из командной строки либо запускаться вручную с помощью Visual Studio.

В этом разделе мы выполним следующие задачи:

* скачаем и создадим пример приложения;
* создадим веб-приложение службы приложений Azure с помощью Azure Cloud Shell;
* развернем пример приложения в Azure;
* развернем изменения в приложении с помощью Visual Studio;
* добавим в веб-приложение промежуточный слот;
* развернем обновление в промежуточном слоте;
* переключим промежуточный и рабочий слоты.

## <a name="download-and-test-the-app"></a>Загрузка и тестирование приложения

Приложение, используемое в этом руководстве, является предварительно созданным приложением ASP.NET Core — [Simple Feed Reader](https://github.com/Azure-Samples/simple-feed-reader/). Это приложение Razor Pages, которое использует API `Microsoft.SyndicationFeed.ReaderWriter` для получения канала RSS/Atom и отображает элементы новостей в списке.

Вы можете проанализировать код, но важно понимать, что в этом приложении нет ничего особенного. Это простое приложение ASP.NET Core для иллюстративных целей.

В командной оболочке скачайте код, выполните сборку проекта и запустите его, как указано ниже.

> *Примечание. Пользователи Linux и macOS должны внести соответствующие изменения в пути, например, используя косую черту (`/`) вместо обратной косой черты (`\`).*

1. Клонируйте код в папку на локальном компьютере.

    ```console
    git clone https://github.com/Azure-Samples/simple-feed-reader/
    ```

2. Измените рабочую папку на созданную папку *simple-feed-reader*.

    ```console
    cd .\simple-feed-reader\SimpleFeedReader
    ```

3. Восстановите пакеты и выполните сборку решения.

    ```dotnetcli
    dotnet build
    ```

4. Запустите приложение.

    ```dotnetcli
    dotnet run
    ```

    ![Команда dotnet run успешно выполнена](./media/deploying-to-app-service/dotnet-run.png)

5. Откройте веб-браузер и перейдите по адресу `http://localhost:5000`. Приложение позволяет вводить или вставлять URL-адрес канала синдикации и просматривать список новостей.

     ![Приложение, отображающее содержимое RSS-канала](./media/deploying-to-app-service/app-in-browser.png)

6. Когда вы удостоверитесь, что приложение работает правильно, закройте его, нажав клавиши **CTRL**+**C** в командной оболочке.

## <a name="create-the-azure-app-service-web-app"></a>Создание веб-приложения службы приложений Azure

Чтобы развернуть приложение, необходимо создать службу приложений [веб-приложение](/azure/app-service/app-service-web-overview). После создания веб-приложения вы сможете развернуть его на локальном компьютере с помощью Git.

1. Войдите в [Azure Cloud Shell](https://shell.azure.com/bash). Примечание. При первом входе Cloud Shell предложит создать учетную запись хранения для файлов конфигурации. Примите значения по умолчанию или укажите уникальное имя.

2. Для выполнения следующих действий используйте Cloud Shell.

    1\. Объявите переменную для хранения имени веб-приложения. Имя должно быть уникальным для использования в URL-адресе по умолчанию. Использование функции Bash `$RANDOM` для создания имени гарантирует уникальность и результаты в формате `webappname99999`.

    ```console
    webappname=mywebapp$RANDOM
    ```

    2\. Создайте группу ресурсов. Группы ресурсов предоставляют средства для агрегирования ресурсов Azure, которыми можно управлять как группой.

    ```azurecli
    az group create --location centralus --name AzureTutorial
    ```

    Команда `az` вызывает [Azure CLI](/cli/azure/). Интерфейс командной строки (CLI) можно запустить локально, но использование его в Cloud Shell экономит время и конфигурацию.

    В. Создайте план службы приложений уровня S1. План службы приложений — это группа веб-приложений, использующих одну и ту же ценовую категорию. Уровень S1 не является бесплатным, но он необходим для использования функции промежуточных слотов.

    ```azurecli
    az appservice plan create --name $webappname --resource-group AzureTutorial --sku S1
    ```

    Г. Создайте ресурс веб-приложения с помощью плана службы приложений в той же группе ресурсов.

    ```azurecli
    az webapp create --name $webappname --resource-group AzureTutorial --plan $webappname
    ```

    Д. Задайте учетные данные развертывания. Эти учетные данные развертывания применяются ко всем веб-приложениям в вашей подписке. Не используйте в имени пользователя специальные символы.

    ```azurecli
    az webapp deployment user set --user-name REPLACE_WITH_USER_NAME --password REPLACE_WITH_PASSWORD
    ```

    f. Настройте веб-приложение на прием развертываний из локального репозитория Git и отобразите *URL-адрес развертывания Git*. **Запишите этот URL-адрес для дальнейшего использования**.

    ```azurecli
    echo Git deployment URL: $(az webapp deployment source config-local-git --name $webappname --resource-group AzureTutorial --query url --output tsv)
    ```

    ж. Отобразите *URL-адрес веб-приложения*. Перейдите по этому URL-адресу — должно отобразиться пустое веб-приложение. **Запишите этот URL-адрес для дальнейшего использования**.

    ```console
    echo Web app URL: http://$webappname.azurewebsites.net
    ```

3. Используя командную оболочку на локальном компьютере, перейдите к папке проекта веб-приложения (например, `.\simple-feed-reader\SimpleFeedReader`). Выполните следующие команды, чтобы настроить Git для отправки в URL-адрес развертывания.

    1\. Добавьте удаленный URL-адрес в локальный репозиторий.

    ```console
    git remote add azure-prod GIT_DEPLOYMENT_URL
    ```

    2\. Отправьте локальную ветвь по умолчанию (*master*) в удаленную ветвь по умолчанию *azure-prod* (*master*).

    ```console
    git push azure-prod master
    ```

    Вам будет предложено ввести учетные данные развертывания, созданные ранее. Просмотрите выходные данные в командной оболочке. Azure выполнит сборку приложения ASP.NET Core удаленно.

4. В браузере перейдите по *URL-адресу веб-приложения* и убедитесь, что приложение создано и развернуто. Дополнительные изменения можно зафиксировать в локальном репозитории Git с помощью команды `git commit`. Эти изменения отправляются в Azure с помощью предыдущей команды `git push`.

## <a name="deployment-with-visual-studio"></a>Развертывание с помощью Visual Studio

> *Примечание. Этот раздел относится только к Windows. Пользователи Linux и macOS должны внести изменения, описанные в шаге 2 ниже. Сохраните файл и зафиксируйте изменения в локальном репозитории с помощью команды `git commit`. Наконец, отправьте изменение с помощью команды `git push`, как описано в первом разделе.*

Приложение уже развернуто из командной оболочки. Давайте используем интегрированные средства Visual Studio для развертывания обновления в приложении. По сути, Visual Studio выполняет ту же задачу, что и средства командной строки, но в привычном пользовательском интерфейсе Visual Studio.

1. Откройте файл *SimpleFeedReader.sln* в Visual Studio.
2. В обозревателе решений откройте файл *Pages\Index.cshtml*. Измените `<h2>Simple Feed Reader</h2>` на `<h2>Simple Feed Reader - V2</h2>`.
3. Нажмите сочетание клавиш **CTRL**+**SHIFT**+**B** для сборки приложения.
4. В обозревателе решений щелкните правой кнопкой мыши проект и выберите **Опубликовать**.

    ![Снимок экрана: щелчок правой кнопкой мыши, команда "Опубликовать"](./media/deploying-to-app-service/publish.png)
5. Visual Studio может создать новый ресурс службы приложений, но это обновление будет опубликовано в существующем развертывании. В диалоговом окне **Выбор целевого объекта публикации** выберите в списке слева **Служба приложений**, а затем нажмите **Выбрать существующий**. Нажмите кнопку **Опубликовать**.
6. В диалоговом окне **Служба приложений** убедитесь, что в правом верхнем углу отображается учетная запись Майкрософт или организации, используемая для создания подписки Azure. Если это не так, щелкните раскрывающийся список и добавьте ее.
7. Убедитесь, что выбрана правильная **подписка** Azure. В поле **Вид** выберите **Группа ресурсов**. Разверните группу ресурсов **AzureTutorial**, а затем выберите существующее веб-приложение. Нажмите кнопку **ОК**.

    ![Снимок экрана: диалоговое окно публикации службы приложений](./media/deploying-to-app-service/publish-dialog.png)

Visual Studio выполнит сборку и развертывание приложения в Azure. Перейдите по URL-адресу приложения. Проверьте, что произошло изменение элемента `<h2>`.

![Приложение с измененным названием](./media/deploying-to-app-service/app-v2.png)

## <a name="deployment-slots"></a>Слоты развертывания

Слоты развертывания поддерживают промежуточное хранение изменений без влияния на приложение, выполняющееся в рабочей среде. После того как промежуточная версия приложения будет проверена командой контроля качества, рабочий и промежуточный слоты можно поменять местами. Таким образом, приложение в промежуточной среде повышается до рабочей среды. Следующие шаги описывают создание промежуточного слота, развертывание некоторых изменений и переключение промежуточного и рабочего слотов после проверки.

1. Войдите в [Azure Cloud Shell](https://shell.azure.com/bash), если еще не сделали этого.
2. Создайте промежуточный слот.

    1\. Создайте слот развертывания с именем *staging*.

    ```azurecli
    az webapp deployment slot create --name $webappname --resource-group AzureTutorial --slot staging
    ```

    2\. Настройте промежуточный слот для использования развертывания из локального репозитория Git и получите URL-адрес развертывания **staging**. **Запишите этот URL-адрес для дальнейшего использования**.

    ```azurecli
    echo Git deployment URL for staging: $(az webapp deployment source config-local-git --name $webappname --resource-group AzureTutorial --slot staging --query url --output tsv)
    ```

    В. Отобразите URL-адрес промежуточного слота. Перейдите по URL-адресу — должен отобразиться пустой промежуточный слот. **Запишите этот URL-адрес для дальнейшего использования**.

    ```console
    echo Staging web app URL: http://$webappname-staging.azurewebsites.net
    ```

3. В текстовом редакторе или в Visual Studio еще раз измените файл *Pages/Index.cshtml*, чтобы элемент `<h2>` стал выглядеть как `<h2>Simple Feed Reader - V3</h2>`, и сохраните файл.

4. Зафиксируйте файл в локальном репозитории Git, используя страницу **Изменения** на вкладке *Team Explorer* в Visual Studio или с помощью следующей команды командной оболочки локального компьютера.

    ```console
    git commit -a -m "upgraded to V3"
    ```

5. С помощью командной оболочки локального компьютера добавьте URL-адрес промежуточного развертывания в качестве удаленного репозитория Git и отправьте зафиксированные изменения:

    1\. Добавьте удаленный URL-адрес для промежуточного хранения в локальный репозиторий Git.

    ```console
    git remote add azure-staging <Git_staging_deployment_URL>
    ```

    2\. Отправьте локальную ветвь по умолчанию (*master*) в удаленную ветвь по умолчанию *azure-staging* (*master*).

    ```console
    git push azure-staging master
    ```

    Подождите, пока Azure создаст и развернет приложение.

6. Чтобы убедиться, что версия 3 (V3) развернута в промежуточном слоте, откройте два окна браузера. В одном окне перейдите к URL-адресу исходного веб-приложения. В другом окне перейдите к URL-адресу промежуточного веб-приложения. Рабочий URL-адрес обслуживает приложение версии 2 (V2). Промежуточный URL-адрес обслуживает приложение версии 3 (V3).

    ![Снимок экрана: сравнение окон браузера](./media/deploying-to-app-service/ready-to-swap.png)

7. В Cloud Shell замените проверенный и испытанный промежуточный слот на рабочий.

    ```azurecli
    az webapp deployment slot swap --name $webappname --resource-group AzureTutorial --slot staging
    ```

8. Убедитесь, что переключение произошло, обновив два окна браузера.

    ![Сравнение окон браузера после переключения](./media/deploying-to-app-service/swapped.png)

## <a name="summary"></a>Сводка

В этом разделе были выполнены следующие задачи:

* скачивание и создание примера приложения;
* создание веб-приложения службы приложений Azure с помощью Azure Cloud Shell;
* развертывание примера приложения в Azure;
* развертывание изменения в приложении с помощью Visual Studio;
* добавление в веб-приложение промежуточного слота;
* развертывание обновления в промежуточном слоте;
* переключение промежуточного и рабочего слотов.

В следующем разделе вы узнаете, как создать конвейер DevOps с помощью Azure Pipelines.

## <a name="additional-reading"></a>Дополнительные материалы для чтения

* [Обзор веб-приложений](/azure/app-service/app-service-web-overview)
* [Сборка веб-приложения .NET Core и базы данных SQL в службе приложений Azure](/azure/app-service/app-service-web-tutorial-dotnetcore-sqldb)
* [Настройка учетных данных развертывания службы приложений Azure](/azure/app-service/app-service-deployment-credentials)
* [Настройка промежуточных сред в службе приложений Azure](/azure/app-service/web-sites-staged-publishing)

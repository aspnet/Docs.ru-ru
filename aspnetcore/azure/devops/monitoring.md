---
title: Мониторинг и отладка — DevOps с помощью ASP.NET Core и Azure
author: CamSoper
description: Мониторинг и отладка кода в рамках решения DevOps с помощью ASP.NET Core и Azure
ms.author: casoper
ms.custom: devx-track-csharp, mvc, seodec18
ms.date: 07/10/2019
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: azure/devops/monitor
ms.openlocfilehash: 74e789828bf5d54e3457f235657f8ed7086df80d
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "93056755"
---
# <a name="monitor-and-debug"></a>Мониторинг и отладка

После развертывания приложения и создания конвейера DevOps важно понять, как отслеживать и устранять неполадки в приложении.

В этом разделе вам предстоит выполнить следующие задачи:

* Поиск основных сведений о мониторинге и устранении неполадок на портале Azure
* Изучение того, как Azure Monitor обеспечивает более подробный обзор метрик по всем службам Azure
* Подключение веб-приложения к Application Insights для профилирования приложений
* Включение ведения журнала и изучение места загрузки журналов
* Потоковая передача журналов в режиме реального времени
* Изучение порядка настройки оповещений
* Получение сведений об удаленной отладке веб-приложений Службы приложений Azure

## <a name="basic-monitoring-and-troubleshooting"></a>Базовый мониторинг и устранение неполадок

Веб-приложения Службы приложений можно с легкостью отслеживать в режиме реального времени. На портале Azure метрики представлены в виде простых и понятных графиков и диаграмм.

1. На [портале Azure](https://portal.azure.com) перейдите к Службе приложений *mywebapp\<unique_number\>* .

1. На вкладке **Обзор** представлены полезные краткие сведения, включая графики недавних метрик.

    ![Снимок экрана с разделом общих сведений](./media/monitoring/overview.png)

    * **HTTP 5xx** : количество ошибок на стороне сервера (как правило, это исключения в коде ASP.NET).
    * **Входные данные** : данные, поступающие в веб-приложение.
    * **Выходные данные** : данные, исходящие из веб-приложения на клиенты.
    * **Запросы** : количество выполненных HTTP-запросов.
    * **Среднее время ответа** : среднее время, в течение которого веб-приложение отвечает на HTTP-запросы.

    На этой странице также представлено несколько средств для самостоятельного устранения неполадок и оптимизации.

    ![Снимок экрана, на котором показаны инструменты для самостоятельного обслуживания](./media/monitoring/wizards.png)

    * **Диагностика и решение проблем**  — средство для самостоятельного устранения неполадок.
    * **Application Insights**  — средство для профилирования производительности и поведения приложений (рассматривается далее в этом разделе).
    * **Помощник по службе приложений**  — предлагает рекомендации по настройке работы приложения.

## <a name="advanced-monitoring"></a>Расширенный мониторинг

[Azure Monitor](/azure/monitoring-and-diagnostics/) — это централизованная служба для мониторинга всех метрик и настройки оповещений в службах Azure. В Azure Monitor администраторы могут подробно отслеживать производительность и выявлять тенденции. Каждая служба Azure предлагает собственный [набор метрик](/azure/monitoring-and-diagnostics/monitoring-supported-metrics#microsoftwebsites-excluding-functions) для Azure Monitor.

## <a name="profile-with-application-insights"></a>Профилирование с помощью Application Insights

[Application Insights](/azure/application-insights/app-insights-overview) — это служба Azure для анализа производительности и стабильности веб-приложений, а также их использования. Данные, получаемые из Application Insights, являются более широкими и более глубокими, чем в Azure Monitor. Эти данные могут предоставить разработчикам и администраторам ключевые сведения для улучшения приложений. Application Insights можно добавить в ресурс Службы приложений Azure без изменения кода.

1. На [портале Azure](https://portal.azure.com) перейдите к Службе приложений *mywebapp\<unique_number\>* .
1. На вкладке **Обзор** щелкните плитку **Application Insights**.

    ![Плитка Application Insights](./media/monitoring/app-insights.png)

1. Установите переключатель **Создать новый ресурс**. Используйте имя ресурса по умолчанию и выберите расположение ресурса Application Insights. Расположение не должно совпадать с расположением веб-приложения.

    ![Настройка Application Insights](./media/monitoring/new-app-insights.png)

1. В раскрывающемся списке **Среда выполнения или платформа** выберите **ASP.NET Core**. Примите настройки по умолчанию.
1. Нажмите кнопку **ОК**. При появлении запроса на подтверждение выберите **Продолжить**.
1. После создания ресурса щелкните имя ресурса Application Insights, чтобы перейти на страницу Application Insights.

    ![Новый ресурс Application Insights готов](./media/monitoring/new-app-insights-done.png)

По мере использования приложения накапливаются данные о работе с ним. Выберите **Обновить** , чтобы перезагрузить колонку с учетом новых данных.

![Вкладка "Обзор" в Application Insights](./media/monitoring/app-insights-overview.png)

Application Insights предоставляет полезные сведения о сервере без дополнительной настройки. Чтобы максимально эффективно использовать Application Insights, [следует инструментировать приложение с помощью пакета SDK для Application Insights](/azure/application-insights/app-insights-asp-net-core). При правильной настройке служба обеспечивает комплексный мониторинг веб-сервера и браузера, включая производительность на стороне клиента. Дополнительные сведения см. в [документации по Application Insights](/azure/application-insights/app-insights-overview).

## <a name="logging"></a>Ведение журнала

Журналы веб-сервера и приложений по умолчанию отключены в Службе приложений Azure. Включите их, выполнив следующие действия.

1. На [портале Azure](https://portal.azure.com) перейдите к Службе приложений *mywebapp\<unique_number\>* .
1. Прокрутите меню слева вниз до раздела **Мониторинг**. Выберите **Журнал диагностики**.

    ![Ссылка "Журналы диагностики"](./media/monitoring/logging.png)

1. Включите параметр **Ведение журнала приложений (файловая система)** . При появлении запроса щелкните соответствующее поле установки расширения, чтобы включить ведение журнала приложений в веб-приложении.
1. Для параметра **Ведение журнала веб-сервера** выберите значение **Файловая система**.
1. В поле **Срок хранения** укажите период хранения в днях. Например, 30.
1. Нажмите кнопку **Сохранить**.

Для веб-приложения создаются журналы ASP.NET Core и журналы веб-сервера (Службы приложений). Их можно загрузить с помощью отображаемых сведений о FTP/FTPS. В качестве пароля используется пароль учетных данных развертывания, которые созданы ранее в этом разделе. Можно [выполнять потоковую передачу журналов прямо на локальный компьютер с помощью PowerShell или Azure CLI](/azure/app-service/web-sites-enable-diagnostic-log#download). Журналы также можно [просматривать в Application Insights](/azure/app-service/web-sites-enable-diagnostic-log#how-to-view-logs-in-application-insights).

## <a name="log-streaming"></a>Потоковая передача журналов

Можно в режиме реального времени выполнять потоковую передачу журналов приложений и веб-сервера на портал.

1. На [портале Azure](https://portal.azure.com) перейдите к Службе приложений *mywebapp\<unique_number\>* .
1. Прокрутите меню слева вниз до раздела **Мониторинг** и выберите **Потоковая передача журнала**.

    ![Снимок экрана со ссылкой "Потоковая передача журнала"](./media/monitoring/log-stream.png)

Также можно [выполнять потоковую передачу журналов через Azure CLI или Azure PowerShell](/azure/app-service/web-sites-enable-diagnostic-log#streamlogs), а также через Cloud Shell.

## <a name="alerts"></a>Предупреждения

Azure Monitor также предоставляет [оповещения в режиме реального времени](/azure/monitoring-and-diagnostics/insights-alerts-portal) на основе метрик, событий администрирования и других критериев.

> *Примечание. В настоящее время оповещение о метриках веб-приложения доступно только в службе "Оповещения (классические)".*

Служба [Оповещения (классические)](/azure/monitoring-and-diagnostics/monitor-quick-resource-metric-alert-portal) находится в Azure Monitor или в разделе **Мониторинг** параметров Службы приложений.

![Ссылка "Оповещения (классические)"](./media/monitoring/alerts.png)

## <a name="live-debugging"></a>Динамическая отладка

Если в журналах недостаточно сведений, отладку Службы приложений Azure можно выполнять [удаленно с помощью Visual Studio](/azure/app-service/web-sites-dotnet-troubleshoot-visual-studio#remotedebug). Однако для удаленной отладки приложение должно быть скомпилировано с отладочными символами. Отладка не должна выполняться в рабочей среде, за исключением крайней необходимости.

## <a name="conclusion"></a>Заключение

В этом разделе вы выполнили следующие задачи:

* Поиск основных сведений о мониторинге и устранении неполадок на портале Azure
* Изучение того, как Azure Monitor обеспечивает более подробный обзор метрик по всем службам Azure
* Подключение веб-приложения к Application Insights для профилирования приложений
* Включение ведения журнала и изучение места загрузки журналов
* Потоковая передача журналов в режиме реального времени
* Изучение порядка настройки оповещений
* Получение сведений об удаленной отладке веб-приложений Службы приложений Azure

## <a name="additional-reading"></a>Дополнительные материалы для чтения

* <xref:test/troubleshoot-azure-iis>
* <xref:host-and-deploy/azure-iis-errors-reference>
* [Мониторинг производительности веб-приложения Azure с помощью Application Insights](/azure/application-insights/app-insights-azure-web-apps)
* [Включение функции ведения журналов диагностики для веб-приложений в службе приложений Azure](/azure/app-service/web-sites-enable-diagnostic-log)
* [Устранение неполадок веб-приложения в службе приложений Azure с помощью Visual Studio](/azure/app-service/web-sites-dotnet-troubleshoot-visual-studio)
* [Создание классических оповещений метрик в Azure Monitor для служб Azure с помощью портала Azure](/azure/monitoring-and-diagnostics/insights-alerts-portal)

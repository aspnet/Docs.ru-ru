---
title: Тестирование компонентов в ASP.NET Core Blazor
author: guardrex
description: Узнайте, как тестировать компоненты в приложениях Blazor.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/10/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: blazor/test
ms.openlocfilehash: cd4aee66fd6df6cc0ce520d8ca66e0a2cf130eff
ms.sourcegitcommit: 3593c4efa707edeaaceffbfa544f99f41fc62535
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2021
ms.locfileid: "93054870"
---
# <a name="test-components-in-aspnet-core-no-locblazor"></a>Тестирование компонентов в ASP.NET Core Blazor

[Эгиль Хансен](https://egilhansen.com/) (Egil Hansen)

Тестирование — важный аспект создания стабильного и поддерживаемого программного обеспечения.

Для тестирования компонента Blazor с *тестируемым компонентом* (CUT) выполняются следующие действия.

* Преобразование для просмотра с соответствующими входными данными для теста.
* В зависимости от типа выполняемого теста может осуществляться взаимодействие с этим компонентом или его изменение. В частности, могут активироваться обработчики событий, например события `onclick` для кнопки.
* Проверка на наличие ожидаемых значений.

## <a name="test-approaches"></a>Методы тестирования

Два распространенных метода тестирования компонентов Blazor — сквозное тестирование (E2E) и модульное тестирование.

* **Модульное тестирование**. [Модульные тесты](/dotnet/core/testing/) написаны с помощью библиотеки модульного тестирования, которая обеспечивает:
  * преобразование компонента для просмотра;
  * проверку выходных данных и состояния компонента;
  * активацию обработчиков событий и методов жизненного цикла;
  * проверочные утверждения, что поведение компонента правильное.

  [bUnit](https://github.com/egil/bUnit) — это пример библиотеки, позволяющей выполнять модульное тестирование компонентовRazor.

* **Тестирование E2E**. Средство выполнения тестов запускает приложение Blazor, содержащее CUT, и автоматизирует экземпляр браузера. Средство тестирования проверяет CUT и взаимодействует с ним через браузер. [Selenium](https://github.com/SeleniumHQ/selenium) — это пример платформы тестирования E2E, которую можно использовать с приложениями Blazor.

В модульном тестировании участвует только компонент Blazor (Razor/C#). Внешние зависимости, такие как службы и JS-взаимодействие, должны быть макетированы. При тестировании E2E компонент Blazor и вся его вспомогательная инфраструктура являются частью теста, включая CSS, JS и API модели DOM и браузера.

*Область тестирования* описывает, насколько обширны тесты. Область тестирования обычно влияет на скорость тестов. Модульные тесты запускаются на подмножестве подсистем приложения и обычно выполняются в течение миллисекунд. Тесты E2E, которые проверяют обширную группу подсистем приложения, могут выполняться несколько секунд. 

Модульное тестирование также предоставляет доступ к экземпляру CUT, позволяя просматривать и проверять внутреннее состояние компонента. При тестировании E2E обычно это невозможно.

В зависимости от среды компонента тесты E2E должны проверять, что ожидаемое состояние среды достигнуто до начала проверки. В противном случае результат будет непредсказуемым. В модульном тестировании преобразование CUT для просмотра и жизненный цикл теста интегрированы в большей степени, что улучшает стабильность тестов.

Тестирование E2E включает в себя запуск нескольких процессов, сетевые и дисковые операции ввода-вывода и другие действия подсистем, которые часто приводят к плохой надежности тестов. Модульные тесты обычно не зависят от подобных проблем.

В следующей таблице приведены различия между этими двумя методами тестирования.

| Функция                       | Модульное тестирование                     | Тестирование E2E                             |
| -------------------------------- | -------------------------------- | --------------------------------------- |
| Область тестирования                       | Только компонент Blazor (Razor/C#) | Компонент Blazor (Razor/C#) с CSS/JS |
| Время выполнения теста              | Миллисекунды                     | Секунды                                 |
| Доступ к экземпляру компонента | Да                              | Нет                                      |
| Чувствительность к среде     | Нет                               | Да                                     |
| Надежность                      | Более надежное                    | Менее надежное                           |

## <a name="choose-the-most-appropriate-test-approach"></a>Выбор наиболее подходящего метода тестирования

Рассмотрим сценарий, когда требуется выбрать тип выполняемого тестирования. Некоторые аспекты описаны в следующей таблице.

| Сценарий | Рекомендованный метод | Комментарии |
| -------- | ------------------ | ------- |
| Компонент без логики JS-взаимодействия | Модульное тестирование | Если в компоненте Blazor отсутствует зависимость от взаимодействия с JS, его можно тестировать без доступа к JS или API модели DOM. В этом сценарии выбор модульного тестирования не имеет никаких недостатков. |
| Компонент с простой логикой JS-взаимодействия | Модульное тестирование | Чаще всего компоненты запрашивают модель DOM или активируют анимацию с помощью JS-взаимодействия. Как правило, в этом сценарии предпочтительным является модульное тестирование, так как довольно просто макетировать JS-взаимодействие через интерфейс <xref:Microsoft.JSInterop.IJSRuntime>. |
| Компонент, зависящий от сложного кода JS | Модульное тестирование и отдельное тестирование JS | Если компонент использует JS-взаимодействие для вызова большой или сложной библиотеки JS, но взаимодействие между компонентом Blazor и библиотекой JS является простым, то, вероятно, лучше всего будет рассматривать компонент и библиотеку JS или код как две отдельные части и тестировать каждую часть индивидуально. Протестируйте компонент Blazor с библиотекой модульного тестирования, а библиотеку JS — с библиотекой тестирования JS. |
| Компонент с логикой, зависящей от действий JS с моделью DOM браузера | Тестирование E2E | Если функциональность компонента зависит от JS и его действий с моделью DOM, проверяйте код Blazor и JS вместе в тесте E2E. Этот подход разработчики платформы Blazor применили к логике отрисовки в браузере Blazor, которая имеет тесно связанные код C# и JS. Код C# и JS должны работать совместно для правильного преобразования компонентов Blazor для просмотра в браузере.
| Компонент, который зависит от сторонней библиотеки компонентов стороннего производителя со сложными для макетирования зависимостями | Тестирование E2E | Если функциональные возможности компонента зависят от сторонней библиотеки компонентов со сложными для макетирования зависимостями, такими как JS-взаимодействие, тестирование E2E может быть единственным вариантом для тестирования компонента. |

## <a name="test-components-with-bunit"></a>Тестирование компонентов с помощью bUnit

Для Blazor отсутствует официальная платформа тестирования Майкрософт, но поддерживаемый сообществом проект [bUnit](https://github.com/egil/bUnit) предоставляет удобный способ модульного тестирования компонентов Blazor.

> [!NOTE]
> bUnit — это сторонняя библиотека тестирования, которая не поддерживается или не обслуживается корпорацией Майкрософт.

bUnit работает с платформами тестирования общего назначения, такими как [MSTest](/dotnet/core/testing/unit-testing-with-mstest), [NUnit](https://nunit.org/) и [xUnit](https://xunit.github.io/). На этих платформах тестирования тесты bUnit выглядят так же, как обычные модульные тесты. Тесты bUnit, интегрированные с платформой тестирования общего назначения, обычно выполняются с помощью:

* [обозревателя тестов Visual Studio](/visualstudio/test/run-unit-tests-with-test-explorer);
* команды [`dotnet test`](/dotnet/core/tools/dotnet-test) CLI в командной оболочке;
* автоматизированного конвейера тестирования DevOps.

> [!NOTE]
> Концепции тестирования и реализации тестов в разных платформах тестирования похожи, но не идентичны. Инструкции см. в документации платформы тестирования.

Ниже показана структура теста bUnit для компонента `Counter` в приложении на основе шаблона проекта Blazor. Компонент `Counter` отображает счетчик и увеличивает его значение при нажатии пользователем кнопки на странице.

```razor
@page "/counter"

<h1>Counter</h1>

<p>Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }
}
```

Следующий тест bUnit проверяет правильность увеличения счетчика CUT при нажатии кнопки.

```csharp
[Fact]
public void CounterShouldIncrementWhenSelected()
{
    // Arrange
    using var ctx = new TestContext();
    var cut = ctx.RenderComponent<Counter>();
    var paraElm = cut.Find("p");

    // Act
    cut.Find("button").Click();
    var paraElmText = paraElm.TextContent;

    // Assert
    paraElmText.MarkupMatches("Current count: 1");
}
```

На каждом шаге теста выполняются следующие действия.

* *Arrange*. Компонент `Counter` преобразуется для просмотра с помощью `TestContext` теста bUnit. Элемент абзаца (`<p>`) CUT обнаруживается и назначается `paraElm`.

* *Act*. Элемент кнопки (`<button>`) обнаруживается и выбирается путем вызова `Click`, который должен увеличить значение счетчика и обновить содержимое тега абзаца (`<p>`). Текстовое содержимое элемента абзаца извлекается путем вызова `TextContent`.

* *Assert*. Для текстового содержимого вызывается метод `MarkupMatches`, который проверяет его соответствие ожидаемой строке `Current count: 1`.

> [!NOTE]
> Метод утверждения `MarkupMatches` отличается от обычного утверждения сравнения строк (например, `Assert.Equal("Current count: 1", paraElmText);`). `MarkupMatches` выполняет семантическое сравнение введенного и ожидаемого исправления HTML. Семантическое сравнение учитывает семантику HTML. Это означает, что такие детали, как незначащие пробелы, игнорируются. Это приводит к повышению стабильности тестов. Дополнительные сведения см. в разделе [Настройка семантического сравнения HTML](https://bunit.egilhansen.com/docs/verification/semantic-html-comparison).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Начало работы с bUnit](https://bunit.egilhansen.com/docs/getting-started/). Инструкции по bUnit включают руководство по созданию тестового проекта, ссылки на пакеты платформ тестирования, а также инструкции по созданию и выполнению тестов.
